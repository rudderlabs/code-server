# ============================================
# lshell Configuration for RudderStack Profiles
# ============================================
# Location: /etc/lshell.conf (copied from config/lshell.conf)
#
# This file controls which commands are allowed in the
# restricted terminal environment.
#
# To add/remove commands: Edit this file and rebuild Docker image
# ============================================

[global]
logpath         : /var/log/lshell/
loglevel        : 2
logfilename     : %u-%y%m%d.log

[default]
# ============================================
# ALLOWED COMMANDS (Whitelist)
# ============================================

# Navigation and file listing
allowed         : ['ls', 'cd', 'pwd', 'dir']

# File viewing (read-only)
allowed         + ['cat', 'head', 'tail', 'less', 'more', 'wc']

# Text search and utilities
allowed         + ['grep', 'find', 'which', 'xargs']
allowed         + ['echo', 'printf', 'date', 'clear', 'true', 'false']

# File operations
allowed         + ['mkdir', 'touch', 'cp', 'mv', 'rm', 'ln']

# Development tools - Node.js
allowed         + ['npm', 'node', 'yarn', 'pnpm', 'npx']

# Development tools - Git
allowed         + ['git']

# Development tools - Python
allowed         + ['python', 'python3', 'pip', 'pip3']

# Development tools - Build
allowed         + ['make', 'cmake']

# ============================================
# RUDDERSTACK PROFILES COMMANDS (pb*)
# ============================================
# 'pb' = bare command
# 'pb *' = pb with any arguments (pb run, pb compile, etc.)
allowed         + ['pb', 'pb *']
allowed         + ['profiles', 'profiles *']

# Safe system commands
allowed         + ['whoami', 'id', 'hostname', 'uname']

# ============================================
# FORBIDDEN COMMANDS (Blacklist)
# ============================================

# Command chaining and shell injection
forbidden       : [';', '&&', '||', '|', '>', '>>', '<', '<<']

# Network/data exfiltration tools
forbidden       + ['aws', 'curl', 'wget', 'nc', 'netcat', 'telnet', 'ssh', 'scp', 'rsync']

# Environment variable access (credential exposure)
forbidden       + ['env', 'printenv', 'export', 'set', 'declare', 'source']

# Editors that can spawn shells
forbidden       + ['vi', 'vim', 'nano', 'emacs', 'ed']

# Interpreters that can bypass restrictions
forbidden       + ['perl', 'ruby', 'php', 'lua', 'awk', 'sed']
forbidden       + ['bash', 'sh', 'zsh', 'csh', 'ksh', 'fish']

# Privilege escalation
forbidden       + ['sudo', 'su', 'chmod', 'chown', 'chgrp']

# Dangerous execution
forbidden       + ['eval', 'exec', 'nohup', 'screen', 'tmux']

# Credential file patterns
forbidden       + ['.aws', 'credentials', '.env', 'secret', '.ssh']

# ============================================
# SECURITY SETTINGS
# ============================================

# Strict mode - block any command not in whitelist
strict          : 1

# High warning counter - don't disconnect Cline AI after blocked attempts
# (AI may trigger many blocked commands while learning)
warning_counter : 1000

# Disable shell escapes entirely (prevents vim/less from spawning shell)
allowed_shell_escape : 0

# Timer - 0 means no session timeout
timer           : 0
