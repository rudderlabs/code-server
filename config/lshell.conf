# ============================================
# lshell Configuration for RudderStack Profiles
# MINIMAL RESTRICTIVE VERSION
# ============================================
# SECURITY STRATEGY:
#   - Shells (bash, sh, dash) exist as files but are BLOCKED by lshell
#   - Physical removal breaks container startup (requires bash)
#   - This approach provides same security without breaking startup
# ============================================

[global]
logpath         : /var/log/lshell/
loglevel        : 2
logfilename     : %%u-%%y%%m%%d.log

[default]
# ============================================
# ALLOWED COMMANDS (Whitelist)
# ============================================
# SECURITY: With strict=1, ONLY these commands can execute
# Everything else is implicitly BLOCKED (even if not in forbidden list)
#
# pb/pb * - RudderStack Profiles CLI (primary purpose)
# ls/cd/pwd - Basic navigation
# cat/head/tail - Read-only file viewing
# grep/find/which - Search utilities
# git - Version control (for users to commit changes)
# ssh - Required by git for SSH transport (push/pull via sshpiper proxy)
# echo/whoami/id - Debugging utilities
allowed         : ['pb', 'pb *', 'pb version *', 'pb run *', 'pb show *', 'pb init *', 'pb compile *', 'pb build *', 'pb audit *', 'pb cleanup *', 'pb discover *', 'pb help *', 'pb migrate *', 'pb query *', 'pb validate *', 'ls', 'cd', 'pwd', 'cat', 'head', 'tail', 'grep', 'find', 'which', 'git', 'ssh', 'echo', 'whoami', 'id']

# ============================================
# FORBIDDEN COMMANDS (Blacklist)
# ============================================
# SECURITY: Explicit blocks for dangerous commands
# Note: With strict=1, these are already blocked (not in whitelist)
# We list them explicitly for:
#   1. Defense in depth (double protection)
#   2. Clear security documentation
#   3. Explicit error messages when blocked
#
# CRITICAL SECURITY BLOCKS:
#   - Shells: bash, sh, dash, zsh, etc. (CANNOT be executed by users)
#   - Network: curl, wget, nc, scp (prevent data exfiltration)
#   - Credentials: env, printenv, aws (prevent credential access)
#   - Interpreters: python, node, perl (prevent code execution bypass)
#   - Patterns: ;, &&, ||, | (prevent command chaining)
# Removed 'sh' (blocks 'show'), 'source' (blocks 'sources'), 'python'/'python3' (blocks '--rpc_python_path')
# Removed 'ssh' â€” required by git for push/pull over SSH. Safe because:
#   - The pod only has an ephemeral key that authenticates to sshpiper (not GitHub directly)
#   - sshpiper only forwards to github.com:22 (hardcoded in Pipe CRD)
#   - The GitHub deploy key never enters the pod
# These are still blocked by strict=1 since they're not in the allowed list.
forbidden       : [';', '&&', '||', '|', '>', '>>', '<', '<<', 'aws', 'curl', 'wget', 'nc', 'netcat', 'telnet', 'scp', 'rsync', 'env', 'printenv', 'export', 'set', 'declare', 'vi', 'vim', 'nano', 'emacs', 'ed', 'pip', 'pip3', 'node', 'perl', 'ruby', 'php', 'lua', 'awk', 'sed', 'bash', 'dash', 'zsh', 'csh', 'ksh', 'fish', 'sudo', 'su', 'chmod', 'chown', 'chgrp', 'eval', 'exec', 'nohup', 'screen', 'tmux', '.aws', 'credentials', '.env', 'secret', '.ssh']

# ============================================
# SECURITY SETTINGS
# ============================================

strict          : 1
warning_counter : 1000
allowed_shell_escape : []
timer           : 0
